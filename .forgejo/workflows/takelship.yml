---
name: takelship

on:
  push:
  workflow_dispatch:

jobs:
  takelship:
    runs-on: takelbuild
    # if: startsWith(github.ref, 'refs/tags/')
    steps:
      - name: Check out repository
        run: |
          git clone http://forgejo-server:3000/takelwerk/takelship.git /tmp/checkout
          rsync -a /tmp/checkout

      - name: Lint ruby
        run: rake rubylint

      - name: Lint project
        run: rake images:project:registry:molecule:lint

      - name: Build takelage project image with packer
        run: rake images:project:build

      - name: Test takelship project registry
        run: rake images:project:registry:molecule:test

      - name: Test takelship project forgejo
        run: rake images:project:forgejo:molecule:test
